{% load static %}
<script src="{% static 'js/watchers_plots.js' %}"></script>


<div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
</div>
<center>
    <div class="row">
        <div class="col-12 col-sm-4 mb-3">
            <div id="USD_Statement" style="height: 300px;"></div>
        </div>
        <div class="col-12 col-sm-4 mb-3">
            <div id="NIS_Statement" style="height: 300px;"></div>
        </div>
        <div class="col-12 col-sm-4 mb-3">
            <div id="EUR_Statement" style="height: 300px;"></div>
        </div>
        <div class="col-12 col-sm-4 mb-3">
            <div id="USD_Distribution" style="height: 300px;"></div>
        </div>
        <div class="col-12 col-sm-4 mb-3">
            <div id="NIS_Distribution" style="height: 300px;"></div>
        </div>
        <div class="col-12 col-sm-4 mb-3">
            <div id="EUR_Distribution" style="height: 300px;"></div>
        </div>
    </div>
</center>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetchWatchersPlotsData("USD", "Statement", on_done);
        fetchWatchersPlotsData("NIS", "Statement", on_done);
        fetchWatchersPlotsData("EUR", "Statement", on_done);
        fetchWatchersPlotsData("USD", "Distribution", on_done);
        fetchWatchersPlotsData("NIS", "Distribution", on_done);
        fetchWatchersPlotsData("EUR", "Distribution", on_done);
    });

    //document.getElementById('USD_Distribution').addEventListener('click', function () {
    //    fetchWatchersPlotsData("USD", "Distribution", on_done_full_width);
    //});

    function on_done(data, currency, event_type) {
        let object_id = currency + "_" + event_type;
        generate_plot(data, event_type, currency, object_id);
    }

    function on_done_full_width(data, currency, event_type) {
        let object_id = currency + "_" + event_type + "_full_width";
        generate_plot(data, event_type, currency, object_id);
    }

    function generate_plot(data, event_type, currency, object_id) {
        document.querySelector('.spinner-border').style.display = 'none';
        let title = event_type + " - " + currency
        console.log("generate_plot", event_type, currency)
        console.log(data)
        // leave only the 12 latest elements in the dada array
        if (event_type == "Statement") {
            data = data.slice(-12);
        }
        console.log(data)
        generateCurrencyPlot(data, title, "", "", object_id);
    }
</script>